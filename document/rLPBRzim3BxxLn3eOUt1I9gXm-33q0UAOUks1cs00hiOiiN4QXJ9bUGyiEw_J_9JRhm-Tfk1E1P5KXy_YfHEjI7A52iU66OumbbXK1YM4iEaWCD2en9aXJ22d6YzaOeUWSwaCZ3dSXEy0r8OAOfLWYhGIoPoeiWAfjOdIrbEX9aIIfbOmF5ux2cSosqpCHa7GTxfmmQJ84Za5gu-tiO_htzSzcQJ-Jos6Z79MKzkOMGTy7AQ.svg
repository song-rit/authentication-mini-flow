<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1681px" preserveAspectRatio="none" style="width:1576px;height:1681px;background:#FFFFFF;" version="1.1" viewBox="0 0 1576 1681" width="1576px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="402" x="594.25" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="392" x="599.25" y="27.9951">Autentication (username / password) short flow</text><rect fill="#DDDDDD" height="1625.1563" style="stroke:#181818;stroke-width:0.5;" width="791.5" x="389" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76" x="746.75" y="55.3638">K8S_ZONE</text><rect fill="#DDDDDD" height="1625.1563" style="stroke:#181818;stroke-width:0.5;" width="348" x="1222.5" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76" x="1358.5" y="55.3638">EC2_ZONE</text><rect fill="#FFFFFF" height="1377.0313" style="stroke:#181818;stroke-width:1.0;" width="10" x="236" y="134.7266"/><rect fill="#FFFFFF" height="1299.9336" style="stroke:#181818;stroke-width:1.0;" width="10" x="539" y="211.8242"/><rect fill="#FFFFFF" height="1086.4727" style="stroke:#181818;stroke-width:1.0;" width="10" x="874.5" y="425.2852"/><rect fill="#FFFFFF" height="39.6992" style="stroke:#181818;stroke-width:1.0;" width="10" x="1135.5" y="582.7813"/><rect fill="#FFFFFF" height="104.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="1135.5" y="1300.5625"/><rect fill="#FFFFFF" height="227.6289" style="stroke:#181818;stroke-width:1.0;" width="10" x="1358" y="718.1445"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1533" y="845.375"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="241" x2="241" y1="124.7266" y2="1603.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="544" x2="544" y1="124.7266" y2="1603.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="879" x2="879" y1="124.7266" y2="1603.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1140.5" x2="1140.5" y1="124.7266" y2="1603.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1362.5" x2="1362.5" y1="124.7266" y2="1603.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1537.5" x2="1537.5" y1="124.7266" y2="1603.1563"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44" x="219" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="226" y="113.4248">web</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44" x="219" y="1602.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="226" y="1622.1514">web</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="493" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="500" y="113.4248">bff_web_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="493" y="1602.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="500" y="1622.1514">bff_web_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149" x="805" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="812" y="113.4248">authentication_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149" x="805" y="1602.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="812" y="1622.1514">authentication_api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1104.5" y="121.4248">k8s_redis</text><path d="M1122.5,72.4297 C1122.5,62.4297 1140.5,62.4297 1140.5,62.4297 C1140.5,62.4297 1158.5,62.4297 1158.5,72.4297 L1158.5,98.4297 C1158.5,108.4297 1140.5,108.4297 1140.5,108.4297 C1140.5,108.4297 1122.5,108.4297 1122.5,98.4297 L1122.5,72.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1122.5,72.4297 C1122.5,82.4297 1140.5,82.4297 1140.5,82.4297 C1140.5,82.4297 1158.5,82.4297 1158.5,72.4297 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1104.5" y="1615.1514">k8s_redis</text><path d="M1122.5,1628.4531 C1122.5,1618.4531 1140.5,1618.4531 1140.5,1618.4531 C1140.5,1618.4531 1158.5,1618.4531 1158.5,1628.4531 L1158.5,1654.4531 C1158.5,1664.4531 1140.5,1664.4531 1140.5,1664.4531 C1140.5,1664.4531 1122.5,1664.4531 1122.5,1654.4531 L1122.5,1628.4531 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1122.5,1628.4531 C1122.5,1638.4531 1140.5,1638.4531 1140.5,1638.4531 C1140.5,1638.4531 1158.5,1638.4531 1158.5,1628.4531 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1326.5" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1333.5" y="113.4248">user_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1326.5" y="1602.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1333.5" y="1622.1514">user_api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1509.5" y="121.4248">ec2_db</text><path d="M1520,72.4297 C1520,62.4297 1538,62.4297 1538,62.4297 C1538,62.4297 1556,62.4297 1556,72.4297 L1556,98.4297 C1556,108.4297 1538,108.4297 1538,108.4297 C1538,108.4297 1520,108.4297 1520,98.4297 L1520,72.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1520,72.4297 C1520,82.4297 1538,82.4297 1538,82.4297 C1538,82.4297 1556,82.4297 1556,72.4297 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1509.5" y="1615.1514">ec2_db</text><path d="M1520,1628.4531 C1520,1618.4531 1538,1618.4531 1538,1618.4531 C1538,1618.4531 1556,1618.4531 1556,1628.4531 L1556,1654.4531 C1556,1664.4531 1538,1664.4531 1538,1664.4531 C1538,1664.4531 1520,1664.4531 1520,1654.4531 L1520,1628.4531 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1520,1628.4531 C1520,1638.4531 1538,1638.4531 1538,1638.4531 C1538,1638.4531 1556,1638.4531 1556,1628.4531 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="1377.0313" style="stroke:#181818;stroke-width:1.0;" width="10" x="236" y="134.7266"/><rect fill="#FFFFFF" height="1299.9336" style="stroke:#181818;stroke-width:1.0;" width="10" x="539" y="211.8242"/><rect fill="#FFFFFF" height="1086.4727" style="stroke:#181818;stroke-width:1.0;" width="10" x="874.5" y="425.2852"/><rect fill="#FFFFFF" height="39.6992" style="stroke:#181818;stroke-width:1.0;" width="10" x="1135.5" y="582.7813"/><rect fill="#FFFFFF" height="104.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="1135.5" y="1300.5625"/><rect fill="#FFFFFF" height="227.6289" style="stroke:#181818;stroke-width:1.0;" width="10" x="1358" y="718.1445"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1533" y="845.375"/><polygon fill="#181818" points="527,207.8242,537,211.8242,527,215.8242,531,211.8242" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="246" x2="533" y1="211.8242" y2="211.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="253" y="206.7583">/api/v1/auth/signInWithPassword</text><path d="M5,139.7266 L5,270.7266 L231,270.7266 L231,149.7266 L221,139.7266 L5,139.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M221,139.7266 L221,149.7266 L231,149.7266 L221,139.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="11" y="156.7935">Reuqest header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="11" y="171.9263">- Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="11" y="187.0591">- Method: POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="11" y="202.1919"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="11" y="217.3247">Request body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="11" y="232.4575">- username: username</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="11" y="247.5903">- password: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="11" y="262.7231"> </text><line style="stroke:#181818;stroke-width:1.0;" x1="549" x2="591" y1="296.9219" y2="296.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="591" x2="591" y1="296.9219" y2="309.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="550" x2="591" y1="309.9219" y2="309.9219"/><polygon fill="#181818" points="560,305.9219,550,309.9219,560,313.9219,556,309.9219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="556" y="291.856">validate request</text><polygon fill="#181818" points="862.5,421.2852,872.5,425.2852,862.5,429.2852,866.5,425.2852" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549" x2="868.5" y1="425.2852" y2="425.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="556" y="420.2192">/api/v1/oauth/auth</text><path d="M176,322.9219 L176,513.9219 L534,513.9219 L534,332.9219 L524,322.9219 L176,322.9219 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M524,322.9219 L524,332.9219 L534,332.9219 L524,322.9219 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="182" y="339.9888"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="182" y="355.1216">Request header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="337" x="182" y="370.2544">- Content-Type: application/x-www-form-urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="182" y="385.3872">- Method: POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="182" y="400.52"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="182" y="415.6528">Request body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="182" y="430.7856">- client_id: bff_web</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="182" y="445.9185">- username: username</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="182" y="461.0513">- password: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="182" y="476.1841">- grant_type: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="182" y="491.3169">- scope: bff_web</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="182" y="506.4497"> </text><line style="stroke:#181818;stroke-width:1.0;" x1="884.5" x2="926.5" y1="540.6484" y2="540.6484"/><line style="stroke:#181818;stroke-width:1.0;" x1="926.5" x2="926.5" y1="540.6484" y2="553.6484"/><line style="stroke:#181818;stroke-width:1.0;" x1="885.5" x2="926.5" y1="553.6484" y2="553.6484"/><polygon fill="#181818" points="895.5,549.6484,885.5,553.6484,895.5,557.6484,891.5,553.6484" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="891.5" y="535.5825">validate request</text><polygon fill="#181818" points="1123.5,578.7813,1133.5,582.7813,1123.5,586.7813,1127.5,582.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="884.5" x2="1129.5" y1="582.7813" y2="582.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="891.5" y="577.7153">check existing users from k8s_redis</text><polygon fill="#181818" points="895.5,618.4805,885.5,622.4805,895.5,626.4805,891.5,622.4805" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="889.5" x2="1139.5" y1="622.4805" y2="622.4805"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="901.5" y="617.4146">return redis object</text><path d="M1150,595.7813 L1150,635.7813 L1283,635.7813 L1283,605.7813 L1273,595.7813 L1150,595.7813 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1273,595.7813 L1273,605.7813 L1283,605.7813 L1273,595.7813 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1156" y="612.8481">Redis object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="1156" y="627.981">- user_id: xxxxxx</text><polygon fill="#181818" points="1346,714.1445,1356,718.1445,1346,722.1445,1350,718.1445" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="884.5" x2="1352" y1="718.1445" y2="718.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="891.5" y="713.0786">/api/v1/validate-credentials</text><path d="M643,646.0469 L643,777.0469 L869,777.0469 L869,656.0469 L859,646.0469 L643,646.0469 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M859,646.0469 L859,656.0469 L869,656.0469 L859,646.0469 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="649" y="663.1138">Reuqest header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="649" y="678.2466">- Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="649" y="693.3794">- Method: POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="649" y="708.5122"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="649" y="723.645">Request body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="649" y="738.7778">- username: username</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="649" y="753.9106">- password: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="649" y="769.0435"> </text><line style="stroke:#181818;stroke-width:1.0;" x1="1368" x2="1410" y1="803.2422" y2="803.2422"/><line style="stroke:#181818;stroke-width:1.0;" x1="1410" x2="1410" y1="803.2422" y2="816.2422"/><line style="stroke:#181818;stroke-width:1.0;" x1="1369" x2="1410" y1="816.2422" y2="816.2422"/><polygon fill="#181818" points="1379,812.2422,1369,816.2422,1379,820.2422,1375,816.2422" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="1375" y="798.1763">validate reqiest</text><polygon fill="#181818" points="1521,841.375,1531,845.375,1521,849.375,1525,845.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1368" x2="1527" y1="845.375" y2="845.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="1375" y="840.3091">query by username</text><polygon fill="#181818" points="1379,870.5078,1369,874.5078,1379,878.5078,1375,874.5078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1373" x2="1537" y1="874.5078" y2="874.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="1385" y="869.4419">return</text><line style="stroke:#181818;stroke-width:1.0;" x1="1368" x2="1410" y1="903.6406" y2="903.6406"/><line style="stroke:#181818;stroke-width:1.0;" x1="1410" x2="1410" y1="903.6406" y2="916.6406"/><line style="stroke:#181818;stroke-width:1.0;" x1="1369" x2="1410" y1="916.6406" y2="916.6406"/><polygon fill="#181818" points="1379,912.6406,1369,916.6406,1379,920.6406,1375,916.6406" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="1375" y="898.5747">validate credentails</text><polygon fill="#181818" points="895.5,941.7734,885.5,945.7734,895.5,949.7734,891.5,945.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="889.5" x2="1362" y1="945.7734" y2="945.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="901.5" y="940.7075">return</text><line style="stroke:#181818;stroke-width:1.0;" x1="884.5" x2="926.5" y1="1092.4688" y2="1092.4688"/><line style="stroke:#181818;stroke-width:1.0;" x1="926.5" x2="926.5" y1="1092.4688" y2="1105.4688"/><line style="stroke:#181818;stroke-width:1.0;" x1="885.5" x2="926.5" y1="1105.4688" y2="1105.4688"/><polygon fill="#181818" points="895.5,1101.4688,885.5,1105.4688,895.5,1109.4688,891.5,1105.4688" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="891.5" y="1087.4028">generate JWT Token with private key</text><path d="M751,958.7734 L751,1225.7734 L869,1225.7734 L869,968.7734 L859,958.7734 L751,958.7734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M859,958.7734 L859,968.7734 L869,968.7734 L859,958.7734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="757" y="975.8403">Access token:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="757" y="990.9731">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="773" y="1006.106">header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="773" y="1021.2388">- alg: rsa256</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="773" y="1036.3716">- typ: JWT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="757" y="1051.5044"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="773" y="1066.6372">payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="773" y="1081.77">- iss</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="20" x="773" y="1096.9028">- jti</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="773" y="1112.0356">- user_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="773" y="1127.1685">- iat</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="773" y="1142.3013">- exp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="773" y="1157.4341">- roles</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="757" y="1172.5669"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="773" y="1187.6997">signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="757" y="1202.8325">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="757" y="1217.9653"> </text><polygon fill="#181818" points="1123.5,1296.5625,1133.5,1300.5625,1123.5,1304.5625,1127.5,1300.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="884.5" x2="1129.5" y1="1300.5625" y2="1300.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="891.5" y="1295.4966">put user session into k8s_redis</text><path d="M646,1236.0313 L646,1351.0313 L869,1351.0313 L869,1246.0313 L859,1236.0313 L646,1236.0313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M859,1236.0313 L859,1246.0313 L869,1246.0313 L859,1236.0313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="652" y="1253.0981">ttl: 300000 milliseconds (5 min)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="652" y="1268.231"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="652" y="1283.3638">Key: user_id:xxxxx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="652" y="1298.4966"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="652" y="1313.6294">Redis object value:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="652" y="1328.7622">- access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="652" y="1343.895">- refrech_token</text><line style="stroke:#181818;stroke-width:1.0;" x1="1145.5" x2="1187.5" y1="1378.0938" y2="1378.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="1187.5" x2="1187.5" y1="1378.0938" y2="1391.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="1146.5" x2="1187.5" y1="1391.0938" y2="1391.0938"/><polygon fill="#181818" points="1156.5,1387.0938,1146.5,1391.0938,1156.5,1395.0938,1152.5,1391.0938" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="1152.5" y="1373.0278">save data</text><polygon fill="#181818" points="895.5,1401.0938,885.5,1405.0938,895.5,1409.0938,891.5,1405.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="889.5" x2="1139.5" y1="1405.0938" y2="1405.0938"/><polygon fill="#181818" points="560,1430.2266,550,1434.2266,560,1438.2266,556,1434.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="554" x2="873.5" y1="1434.2266" y2="1434.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="566" y="1429.1606">return</text><polygon fill="#181818" points="252,1507.7578,242,1511.7578,252,1515.7578,248,1511.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="246" x2="543" y1="1511.7578" y2="1511.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="258" y="1506.6919">return</text><path d="M554,1447.2266 L554,1562.2266 L780,1562.2266 L780,1457.2266 L770,1447.2266 L554,1447.2266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M770,1447.2266 L770,1457.2266 L780,1457.2266 L770,1447.2266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="560" y="1464.2935">Response header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="560" y="1479.4263">- Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="560" y="1494.5591"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="560" y="1509.6919">Response body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="560" y="1524.8247">- accessToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="560" y="1539.9575">- RefreshToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="560" y="1555.0903"> </text><!--MD5=[b5a9c0465a412568f3790100fb9af0fb]
@startuml
title Autentication (username / password) short flow
' autonumber
skinparam ParticipantPadding 100
skinparam BoxPadding 20

participant web

box K8S_ZONE
participant bff_web_api
participant authentication_api
database k8s_redis
end box

box EC2_ZONE
participant user_api
database ec2_db
end box

activate web
web -> bff_web_api : /api/v1/auth/signInWithPassword

' activate authentication_api
note left
    Reuqest header
    - Content-Type: application/json
    - Method: POST

    Request body
    - username: username
    - password: password

end note
activate bff_web_api

bff_web_api -> bff_web_api : validate request
bff_web_api -> authentication_api : /api/v1/oauth/auth
activate authentication_api
note left
    
    Request header
    - Content-Type: application/x-www-form-urlencoded
    - Method: POST

    Request body
    - client_id: bff_web
    - username: username
    - password: password
    - grant_type: password
    - scope: bff_web

end note
authentication_api -> authentication_api : validate request
authentication_api -> k8s_redis : check existing users from k8s_redis
activate k8s_redis
k8s_redis - -> authentication_api: return redis object
note right
    Redis object
    - user_id: xxxxxx
end note
deactivate k8s_redis
authentication_api -> user_api : /api/v1/validate-credentials
note left
    Reuqest header
    - Content-Type: application/json
    - Method: POST

    Request body
    - username: username
    - password: password

end note
activate user_api
user_api -> user_api : validate reqiest
user_api -> ec2_db : query by username
activate ec2_db
ec2_db - -> user_api : return
deactivate ec2_db
user_api -> user_api : validate credentails

user_api - -> authentication_api: return
deactivate user_api

authentication_api -> authentication_api : generate JWT Token with private key
note left
    Access token:
    {
        header
        - alg: rsa256
        - typ: JWT

        payload
        - iss
        - jti
        - user_id
        - iat
        - exp
        - roles

        signature
    }

end note
authentication_api -> k8s_redis : put user session into k8s_redis
activate k8s_redis
note left
    ttl: 300000 milliseconds (5 min)

    Key: user_id:xxxxx

    Redis object value:
    - access_token
    - refrech_token
end note
k8s_redis -> k8s_redis: save data
k8s_redis - -> authentication_api
deactivate k8s_redis
' alt#Gold #LightBlue success
authentication_api - -> bff_web_api : return

bff_web_api - -> web : return
note right
    Response header
    - Content-Type: application/json

    Response body
    - accessToken
    - RefreshToken

end note
deactivate authentication_api
|||
deactivate bff_web_api
deactivate web
@enduml

@startuml
title Autentication (username / password) short flow
skinparam ParticipantPadding 100
skinparam BoxPadding 20

participant web

box K8S_ZONE
participant bff_web_api
participant authentication_api
database k8s_redis
end box

box EC2_ZONE
participant user_api
database ec2_db
end box

activate web
web -> bff_web_api : /api/v1/auth/signInWithPassword

note left
    Reuqest header
    - Content-Type: application/json
    - Method: POST

    Request body
    - username: username
    - password: password

end note
activate bff_web_api

bff_web_api -> bff_web_api : validate request
bff_web_api -> authentication_api : /api/v1/oauth/auth
activate authentication_api
note left
    
    Request header
    - Content-Type: application/x-www-form-urlencoded
    - Method: POST

    Request body
    - client_id: bff_web
    - username: username
    - password: password
    - grant_type: password
    - scope: bff_web

end note
authentication_api -> authentication_api : validate request
authentication_api -> k8s_redis : check existing users from k8s_redis
activate k8s_redis
k8s_redis - -> authentication_api: return redis object
note right
    Redis object
    - user_id: xxxxxx
end note
deactivate k8s_redis
authentication_api -> user_api : /api/v1/validate-credentials
note left
    Reuqest header
    - Content-Type: application/json
    - Method: POST

    Request body
    - username: username
    - password: password

end note
activate user_api
user_api -> user_api : validate reqiest
user_api -> ec2_db : query by username
activate ec2_db
ec2_db - -> user_api : return
deactivate ec2_db
user_api -> user_api : validate credentails

user_api - -> authentication_api: return
deactivate user_api

authentication_api -> authentication_api : generate JWT Token with private key
note left
    Access token:
    {
        header
        - alg: rsa256
        - typ: JWT

        payload
        - iss
        - jti
        - user_id
        - iat
        - exp
        - roles

        signature
    }

end note
authentication_api -> k8s_redis : put user session into k8s_redis
activate k8s_redis
note left
    ttl: 300000 milliseconds (5 min)

    Key: user_id:xxxxx

    Redis object value:
    - access_token
    - refrech_token
end note
k8s_redis -> k8s_redis: save data
k8s_redis - -> authentication_api
deactivate k8s_redis
authentication_api - -> bff_web_api : return

bff_web_api - -> web : return
note right
    Response header
    - Content-Type: application/json

    Response body
    - accessToken
    - RefreshToken

end note
deactivate authentication_api
|||
deactivate bff_web_api
deactivate web
@enduml

PlantUML version 1.2022.10beta1(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>